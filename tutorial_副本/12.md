## Ex1: 鱼缸水位
* **Public fields:**
	- `capacity`: The maximum water capacity in liters (set during initialization)
	- `water.level`: The current water level in liters (starts at 0)
- **Public methods:**
	- `initialize(capacity)`: Takes a positive numeric capacity and initializes the tank
	- `fill(amount)`: Adds water to the tank. Should not exceed capacity. Returns `invisible(self)` for chaining.
	- `drain(amount)`: Removes water from the tank. Should not go below 0. Returns `invisible(self)` for chaining.
	- `status()`: Returns a character string describing the tank, e.g. `"Tank: 50/100 liters (50%)"`
```r
FishTank <- R6Class("FishTank",
  public = list(
    capacity = NULL,  # 鱼缸最大容量
    water.level = NULL,  # 当前水位
    initialize = function(capacity) {
      # your code
      assertNumber(capacity, lower = 0)  # 验证：非负数
      self$capacity <- capacity  # 设置容量
      self$water.level <- 0  # 水位从 0 开始
    },
    fill = function(amount) {
      assertNumber(amount, lower = 0)  # 验证：非负数
      # 加水，但不超过容量
      self$water.level <- min(self$water.level + amount, self$capacity)
      invisible(self)  # 返回自身，支持链式调用
    },
    drain = function(amount) {
      # your code
      assertNumber(amount, lower = 0)  # 验证：非负数
      # 排水，但不低于 0
      self$water.level <- max(self$water.level - amount, 0)
      invisible(self)
    },
    status = function() {
      pct <- round(100 * self$water.level / self$capacity)# 计算百分比
      sprintf("Tank: %g/%g liters (%d%%)", self$water.level, self$capacity, pct)
    }
  )
)
```


## Ex2: 温度转换
* **Private fields:**
	* `.celsius`: The temperature stored internally in Celsius
* **Public methods:**
	* `initialize(celsius)`: Sets the initial temperature in Celsius (default 20)
* **Active bindings:**
	- `celsius`: Get or set the temperature in Celsius
	- `fahrenheit`: Get or set the temperature in Fahrenheit (conversion: F = C * 9/5 + 32)
```r
Thermometer <- R6Class("Thermometer",
  public = list(
    initialize = function(celsius = 20) {
      assertNumber(celsius)
      private$.celsius <- celsius
    }
  ),
  active = list(
    celsius = function(value) {
      # your code
      if(missing(value)) {
        # 没传参数 = 读取操作
        private$.celsius  #默认值是 20 摄氏度
      } else {
        # 传了参数 = 写入操作
        assertNumber(value)
        private$.celsius <- value
      }
    },
    fahrenheit = function(value) {
      # your code
      if(missing(value)) {
        # 读取：摄氏度 → 华氏度
        private$.celsius * 9/5 + 32
      } else {
        # 写入：华氏度 → 摄氏度
        assertNumber(value)
        private$.celsius <- (value - 32) * 5/9
      }
    }
  ),
  private = list(
    # 用 . 开头表示私有，外部无法直接访问 thermo$.celsius
    .celsius = NULL  # 内部存储，只用摄氏度
  )
)
```


## 鱼类和金鱼(子父类)
* **Class `Fish`** should have:
	- Public field `name`: The fish's name
	- Public field `age`: The fish's age in years
	- Public method `initialize(name, age)`: Initialize with name (string) and age (non-negative number)
	- Public method `swim()`: Returns the string `"<name> is swimming."`
	- Public method `describe()`: Returns `"<name> is a <age>-year-old fish."`
- **Class `GoldFish`** should inherit from `Fish` and:
	- Add a public field `color` (e.g., "orange", "white")
	- Override `initialize(name, age, color)` to also set the color (call the parent's initialize using `super$`)
	- Override `describe()` to return `"<name> is a <age>-year-old <color> goldfish."`
	- Keep the inherited `swim()` method unchanged
```r
Fish <- R6Class("Fish",
  public = list(
    name = NULL,
    age = NULL,
    initialize = function(name, age) {
      assertString(name)
      assertNumber(age, lower = 0)
      self$name <- name
      self$age <- age
    },
    # GoldFish 没有定义 swim()，所以直接继承 Fish 的
    swim = function() { 
      sprintf("%s is swimming.", self$name)
    },
    # GoldFish 覆盖了 describe
    describe = function() {
      sprintf("%s is a %g-year-old fish.", self$name, self$age)
    }
  )
)

GoldFish <- R6Class("GoldFish",
  inherit = Fish,  # 继承自 Fish, GoldFish 自动获得 Fish 的所有字段和方法
  public = list(
    color = NULL,
    initialize = function(name, age, color) {
      # your code
      super$initialize(name, age)  # 调用父类的 initialize
      assertString(color)
      self$color <- color
    },
    describe = function() {
      # your code
      sprintf("%s is a %g-year-old %s goldfish.", self$name, self$age, self$color)
    }
  )
)
```


## 水族馆
* **Public fields:**
	- `name`: The aquarium's name
	- `tank`: A `FishTank` object
	- `fish`: A list of `Fish` objects (starts empty)
- **Public methods:**
	- `initialize(name, tank.capacity)`: Create the aquarium with a name and a new `FishTank` of given capacity
	- `addFish(fish)`: Add a `Fish` object to the aquarium. Returns `invisible(self)`.
	- `listFish()`: Returns a character vector of fish names
- **Private methods:**
	- `deep_clone(name, value)`: Properly clone the `tank` and each fish in the `fish` list
```r
Aquarium <- R6Class("Aquarium",
  public = list(
    name = NULL,
    tank = NULL,
    fish = list(),
    initialize = function(name, tank.capacity) {
      assertString(name)
      self$name <- name
      self$tank <- FishTank$new(tank.capacity)
      self$fish <- list()
    },
    addFish = function(fish) {
      assertR6(fish, "Fish")
      # your code
      self$fish <- c(self$fish, list(fish))  # 添加到列表
      invisible(self)  # 支持链式调用
    },
    listFish = function() {
      # your code
      sapply(self$fish, function(f) f$name)  # 遍历每条鱼，提取名字
    }
  ),
  private = list(
    deep_clone = function(name, value) {
      # your code
      if(name == "Tank") {
        # tank 是单个 R6 对象，直接克隆
        value$clone(deep = TRUE)
      } else if(name == "fish") {
        # fish 是 R6 对象的列表，逐个克隆
        lapply(value, function(f) f$clone(deep = TRUE))
      } else {
        # 其他字段直接返回
        value
      }
    }
  )
)
```


## 水质管理
* **Private fields:**
	- `.readings`: A list storing reading history (each element is a list with `timestamp`, `ph`, and `temp`)
	- `.ph.range`: Numeric vector of length 2 with safe pH range (default `c(6.5, 8.0)`)
	- `.temp.range`: Numeric vector of length 2 with safe temperature range in Celsius (default `c(22, 28)`)
* **Public methods:**
	- `initialize(ph.range, temp.range)`: Set the safe ranges (with defaults)
	- `addReading(ph, temp)`: Record a new reading with current timestamp (`Sys.time()`). Returns `invisible(self)`.
	- `getAlerts()`: Returns a character vector of current alerts based on the *most recent* reading, e.g. `"pH too low (6.2)"` or `"Temperature too high (30)"`. Returns `character(0)` if no readings or all values in range.
	- `getHistory()`: Returns a `data.frame` with columns `timestamp`, `ph`, `temp`
- **Active bindings:**
	- `reading.count`: Returns the number of readings recorded (read-only)

```r
WaterQualityMonitor <- R6Class("WaterQualityMonitor",
  public = list(
    initialize = function(ph.range = c(6.5, 8.0), temp.range = c(22, 28)) {
      # your code
      assertNumeric(ph.range, len = 2)
      assertNumeric(temp.range, len = 2)
      private$.ph.range <- ph.range
      private$.temp.range <- temp.range
      private$.readings <- list()
    },
    addReading = function(ph, temp) {
      # your code
      assertNumber(ph)
      assertNumber(temp)
      # 创建一条读数记录
      readings <- list(
        timestamp = Sys.time(),  # 当前时间
        ph = ph,
        temp = temp
      )
      
      # 追加到列表
      private$.readings <- c(private$.readings, list(readings))
      invisible(self)  # 支持链式调用
    },
    getAlerts = function() {
      # your code
      # 没有读数，返回空向量
      if(length(private$.readings) == 0) {
        return(character(0))
      }
      
      # 获取最新读数
      latest <- private$.readings[[length(private$.readings)]]
      alerts <- character(0)
      
      # 检查 pH
      if (latest$ph < private$.ph.range[1]) {
        alerts <- c(alerts, sprintf("pH too low (%.1f)", latest$ph))
      } else if (latest$ph > private$.ph.range[2]) {
        alerts <- c(alerts, sprintf("pH too high (%.1f)", latest$ph))
      }
      
      # 检查温度
      if (latest$temp < private$.temp.range[1]) {
        alerts <- c(alerts, sprintf("Temperature too low (%.1f)", latest$temp))
      } else if (latest$temp > private$.temp.range[2]) {
        alerts <- c(alerts, sprintf("Temperature too high (%.1f)", latest$temp))
      }
      
      alerts
    },
    getHistory = function() {
      # your code
      # 无读数时返回空 data.frame（保持列结构）
      if(length(private$.readings) == 0) {
        return(data.frame(timestamp = as.POSIXct(
          character()), ph = numeric(), temp = numeric()))
      }
      
      # 从列表中提取各列
      data.frame(
        timestamp = sapply(private$.readings, function(r) r$timestamp),
        ph = sapply(private$.readings, function(r) r$ph),
        temp = sapply(private$.readings, function(r) r$temp)
      )
    }
  ),
  active = list(
    reading.count = function(value) {
      # your code
      if (!missing(value)) {
        stop("reading.count is read-only")  # 禁止写入
      }
      length(private$.readings)  # 返回读数数量
    }
  ),
  private = list(
    .readings = list(),
    .ph.range = NULL,
    .temp.range = NULL
  )
)
```